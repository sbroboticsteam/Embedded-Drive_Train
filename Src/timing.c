/*-----------------------------------------------------------------------
-   File Name:	  timing.c
-   Description:  Timing functionality for general timers
-   Date:	  1/14/2019
-   Name:	  John Boccio
- Stony Brook University Robotics
-----------------------------------------------------------------------*/

/*-----------------------------------------------------------------------
- Private Includes
-----------------------------------------------------------------------*/
#include "timing.h"
/*-----------------------------------------------------------------------
- Private Defines & Macros
-----------------------------------------------------------------------*/

/*-----------------------------------------------------------------------
- Private Typedefs & Enumerations
-----------------------------------------------------------------------*/

/*-----------------------------------------------------------------------
- Private Variables
-----------------------------------------------------------------------*/

/*-----------------------------------------------------------------------
- Private Function Prototypes
-----------------------------------------------------------------------*/

/*-----------------------------------------------------------------------
- Private External References
-----------------------------------------------------------------------*/

/*-----------------------------------------------------------------------
- Public Functions
-----------------------------------------------------------------------*/
void set_timer(timer_t *timer, uint32_t duration) {
  timer->expire_time = HAL_GetTick() + duration;
  timer->enabled = 1;
}

void stop_timer(timer_t *timer) {
  timer->enabled = 0;
}

bool timer_running(timer_t *timer) {
  return timer->enabled;
}

bool timeout(timer_t *timer) {
  return timer->enabled && ((int32_t)(HAL_GetTick() - timer->expire_time) >= 0);
}

/*-----------------------------------------------------------------------
- Private Functions
-----------------------------------------------------------------------*/